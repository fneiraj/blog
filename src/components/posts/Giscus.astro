---
import { GISCUS } from "@config";
---

<div
  class="pb-6 pt-6 text-center text-gray-700 dark:text-gray-300"
  id="comment"
>
  <script is:inline {...GISCUS} async></script>
</div>

<script is:inline>
  document.addEventListener(
    "astro:page-load",
    () => {
      let giscusIframe = document.querySelector("iframe.giscus-frame");
      while (!giscusIframe) {
        giscusIframe = document.querySelector("iframe.giscus-frame");
        giscusIframe?.addEventListener("load", function () {
          function changeGiscusTheme() {
            function sendMessage(message) {
              const iframe = document.querySelector("iframe.giscus-frame");
              if (!!iframe) {
                iframe.contentWindow.postMessage(
                  { giscus: message },
                  "https://giscus.app",
                );
              }
            }

            const theme = localStorage.getItem("theme") || "dark";

            sendMessage({
              setConfig: {
                theme: theme,
              },
            });
          }

          changeGiscusTheme();
        });
      }
    },
    {
      once: false,
    },
  );
</script>
